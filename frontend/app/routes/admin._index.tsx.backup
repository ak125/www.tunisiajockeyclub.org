import { json, type LoaderFunctionArgs } from "@remix-run/node";
import { useLoaderData } from "@remix-run/react";
import { DashboardLayout } from "~/components/dashboard/layout";
import { StatsCards } from "~/components/dashboard/stats-cards";
import { RaceChart } from "~/components/dashboard/race-chart";
import { RecentRaces } from "~/components/dashboard/recent-races";
import { LiveUpdates } from "~/components/dashboard/live-updates";

export const loader = async ({ context }: LoaderFunctionArgs) => {
  // Récupérer les données du dashboard
  const stats = {
    totalRaces: 127,
    activeHorses: 342,
    totalUsers: 1584,
    revenue: 125430,
  };
  
  const recentRaces = [
    { id: '1', name: 'Prix de Carthage', date: '2025-08-21', status: 'upcoming' as const },
    { id: '2', name: 'Prix de Tunis', date: '2025-08-20', status: 'finished' as const },
    { id: '3', name: 'Prix de Kassar Said', date: '2025-08-19', status: 'finished' as const },
  ];

  return json({ stats, recentRaces });
};

export default function AdminDashboard() {
  const { stats, recentRaces } = useLoaderData<typeof loader>();

  return (
    <DashboardLayout>
      <div className="space-y-8">
        {/* Header */}
        <div className="flex justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold text-gray-900 dark:text-white">
              Tableau de Bord
            </h1>
            <p className="text-gray-600 dark:text-gray-400">
              Bienvenue sur votre centre de contrôle TJC
            </p>
          </div>
          <LiveUpdates />
        </div>

        {/* Stats Cards */}
        <StatsCards stats={stats} />

        {/* Charts et Tables */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div className="lg:col-span-2">
            <RaceChart />
          </div>
          <div className="lg:col-span-1">
            <RecentRaces races={recentRaces} />
          </div>
        </div>
      </div>
    </DashboardLayout>
  );
}
